!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=jQuery},function(e){e.exports=JSON.parse('{"pageTitle":"Quest Schedule Exporter","pageDesc":"This unofficial tool allows University of Waterloo students to export their schedule from Quest. This generates an iCalendar file that you can import anywhere. Everything is done on the client-side using JavaScript so you can rest assured that your personal information won\'t be leaked.","MAX_COURSES":20,"MAX_SECTIONS":5,"filename":"quest_schedule.ics","placeholders":[{"placeholder":"@code","description":"Course code","example":"CS 452"},{"placeholder":"@section","description":"Course section number","example":"001"},{"placeholder":"@name","description":"Name of the course","example":"Real-time Programming"},{"placeholder":"@type","description":"Type of course","example":"LEC"},{"placeholder":"@location","description":"Room for the course","example":"DWE 3522A"},{"placeholder":"@prof","description":"Instructor for the course","example":"William B Cowan"}],"summary":"@code @type in @location","description":"@code-@section: @name (@type) in @location with @prof"}')},function(e,t,n){"use strict";n.r(t);var r=n(1);const o={m:1,t:2,w:3,h:4,f:5},s={m:"MO",t:"TU",w:"WE",h:"TH",f:"FR"};class a{constructor(e,t,n,r,a,l,c,p,f,h,m,y){this.meta={code:e,name:t,section:u(n),type:u(r),location:u(a),prof:u(l)};const D=p.replace(/Th/g,"H").toLowerCase();this.classDaysICal=Array.from(D).map(e=>s[e]).join(",");const g=function(){if(m===y)return null;const e=d(c,y);return e.setHours(23),e.setMinutes(59),e}();this.untilDateICal=i(g);const w=function(){const e=d(c,m),t=D.split("").map(e=>o[e]);let n=0;for(;!t.includes(e.getDay())&&n++<365;){if(365===n)throw new Error("Invalid first date of class");e.setDate(e.getDate()+1)}return e}(),E=function(e){const t=/(1?\d):([0-5]\d)/.exec(e);if(!t)return null;const n=parseInt(t[1]),r=parseInt(t[2]);let o=0;/PM/.exec(e)&&n<12&&(o=12);const s=new Date(w.getTime());return s.setHours(s.getHours()+n+o),s.setMinutes(s.getMinutes()+r),s};this.startTimeOnFirstDate=i(E(f)),this.endTimeOnFirstDate=i(E(h))}*printer(e,t){yield"BEGIN:VEVENT",yield"DTSTART;TZID=America/Toronto:"+this.startTimeOnFirstDate,yield"DTEND;TZID=America/Toronto:"+this.endTimeOnFirstDate,this.untilDateICal&&(yield"RRULE:FREQ=WEEKLY;UNTIL="+this.untilDateICal+";WKST=SU;BYDAY="+this.classDaysICal),yield"SUMMARY:"+l(this.fillPlaceholders(e)),yield"LOCATION:"+this.meta.location,yield"DESCRIPTION:"+l(this.fillPlaceholders(t)),yield"END:VEVENT"}fillPlaceholders(e){let t=e;for(const e of r.placeholders){const n=e.placeholder.substring(1),r=new RegExp("("+e.placeholder+")","g");t=t.replace(r,this.meta[n])}return t}}function i(e){return e?""+e.getFullYear().toString()+c(e.getMonth()+1)+c(e.getDate())+"T"+c(e.getHours())+c(e.getMinutes())+c(e.getSeconds()):""}function l(e){return e.replace(/,/g,"\\,")}function c(e){return e.toString().padStart(2,"0")}function u(e){return e.replace(/\s+/g," ").trim()}function d(e,t){const n=t.split("/").map(e=>parseInt(e));let r,o,s;switch(e){case"DD/MM/YYYY":r=n[2],o=n[1]-1,s=n[0];break;case"MM/DD/YYYY":r=n[2],o=n[0]-1,s=n[1];break;case"YYYY/MM/DD":r=n[0],o=n[1]-1,s=n[2];break;case"YYYY/DD/MM":r=n[0],o=n[2]-1,s=n[1];break;case"MM/YYYY/DD":r=n[1],o=n[0]-1,s=n[2];break;case"DD/YYYY/MM":r=n[1],o=n[2]-1,s=n[0];break;default:return new Date(t)}return new Date(r,o,s)}class p{constructor(e,t,n,r){this._dateFormatType=e,this._questData=t,this._summary=n,this._description=r,this._courses=[]}run(){this.parseData();const e=this.generateICal();this.downloadFile(e)}parseData(){const e=function(){const e="(\\w{2,5} \\d{3,4}) - (.*)"+(t="(\\w{2,5} \\d{3,4}) - (.*)","(?:(?!"+t+")[\\w|\\W])*");var t;return new RegExp(e,"g")}(),t=function(e){const t=null===/([0-5]\d[A|P]M)/.exec(e)?"[0-2]\\d\\:[0-5]\\d":"1?\\d\\:[0-5]\\d[AP]M",n=function(e){return"("+e+"|TBA)\\s*"},r="(\\d{4})\\s*(\\d{3}\\s*)(\\w{3}\\s*)"+n("([MThWF]{0,6})\\s*("+t+")\\ -\\ ("+t+")\\s*")+n("[\\w\\ ]+\\s*[0-9]{1,5}[A-Z]?")+n("[A-Za-z_\\ \\-\\,\\s]+")+"(\\d{2,4}\\/\\d{2,4}\\/\\d{2,4})\\ -\\ (\\d{2,4}\\/\\d{2,4}\\/\\d{2,4})";return new RegExp(r,"g")}(this._questData);let n=0,o=null;for(;;){if(n++>r.MAX_COURSES){console.warn("Exceeded loop count while searching for courses");break}if(o=e.exec(this._questData),!o)break;let s=0,i=null;for(;;){if(s++>r.MAX_SECTIONS){console.warn("Exceeded loop count while searching for sections");break}if(i=t.exec(o[0]),!i)break;if("TBA"===i[4])continue;const e=new a(o[1],o[2],i[2],i[3],i[8],i[9],this._dateFormatType,i[5],i[6],i[7],i[10],i[11]);this._courses.push(e)}}if(0===n||n>=r.MAX_COURSES)throw new Error("Failed Search")}generateICal(){let e="";const t=function(t){e+=t+"\n"};t("BEGIN:VCALENDAR"),t("VERSION:2.0"),t("PRODID:-//www.QuestScheduleExporter.xyz//EN");for(const e of this._courses){const n=e.printer(this._summary,this._description);let r;for(;!(r=n.next()).done;)t(r.value)}return t("END:VCALENDAR"),e}downloadFile(e){const t=document.createElement("a");t.setAttribute("href","data:text/calendar;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r.filename),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)}}var f=n(0),h=n.n(f);h.a.when(h.a.ready).then(()=>{h()("button#generateBtn").on("click",e=>{e.preventDefault();const t=h()("select#dateFormatType").val(),n=h()("textarea#questData").val(),r=h()("input#summary").val(),o=h()("input#description").val();try{new p(t,n,r,o).run()}catch(e){console.error(e),alert("Unable to generate iCalendar file! Please submit an issue on GitHub.")}})})}]);